<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Post Creation</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .container {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        h1 {
            color: #FFD700;
            margin-bottom: 30px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            color: rgba(255, 255, 255, 0.8);
            font-weight: 600;
        }
        input, textarea, select {
            width: 100%;
            padding: 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: #fff;
            font-size: 16px;
        }
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        button {
            background: #FFD700;
            color: #000;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            margin-right: 10px;
            margin-top: 10px;
        }
        button:hover {
            background: #FFC700;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            background: rgba(0, 255, 0, 0.1);
            border-radius: 8px;
            white-space: pre-wrap;
            display: none;
        }
        .error {
            background: rgba(255, 0, 0, 0.1);
        }
        .test-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
        }
        .status-indicator {
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 20px;
            background: rgba(255, 215, 0, 0.1);
            border: 1px solid #FFD700;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ Best App - Post Testing</h1>
        
        <div class="status-indicator" id="status">
            Checking authentication...
        </div>

        <div class="form-group" id="loginSection">
            <label>Quick Login:</label>
            <button onclick="quickLogin()" style="background: #4AE54A;">üîê Login as Test User</button>
        </div>

        <div class="form-group">
            <label for="postType">Post Type:</label>
            <select id="postType">
                <option value="status">Status (Text Post)</option>
                <option value="checkin">Check-in (Action Completion)</option>
                <option value="photo">Photo</option>
                <option value="audio">Audio</option>
                <option value="goal">Goal Announcement</option>
            </select>
        </div>

        <div class="form-group">
            <label for="content">Content:</label>
            <textarea id="content" placeholder="Write your post content here...">This is a test post with actual content!</textarea>
        </div>

        <div class="form-group">
            <label for="visibility">Visibility:</label>
            <select id="visibility">
                <option value="circle">Circle (Close friends)</option>
                <option value="follow">Follow (All followers)</option>
                <option value="public">Public</option>
            </select>
        </div>

        <div class="form-group" id="checkinFields" style="display:none;">
            <label for="actionTitle">Action Title:</label>
            <input type="text" id="actionTitle" value="Morning workout" />
            
            <label for="goalTitle" style="margin-top:10px;">Goal:</label>
            <input type="text" id="goalTitle" value="Get fit" />
            
            <label for="goalColor" style="margin-top:10px;">Goal Color:</label>
            <input type="color" id="goalColor" value="#10B981" />
            
            <label for="streak" style="margin-top:10px;">Streak Days:</label>
            <input type="number" id="streak" value="1" />
        </div>

        <button onclick="createPost()">üìù Create Post</button>
        
        <div class="test-buttons">
            <button onclick="testCheckin()">‚úÖ Test Check-in Post</button>
            <button onclick="testStatus()">üí≠ Test Status Post</button>
            <button onclick="testGoal()">üéØ Test Goal Post</button>
            <button onclick="fetchPosts()">üìñ View All Posts</button>
            <button onclick="clearForm()">üóëÔ∏è Clear Form</button>
        </div>

        <div id="result" class="result"></div>
    </div>

    <script>
        // Check auth on load
        window.onload = function() {
            checkAuth();
        };

        function checkAuth() {
            const token = localStorage.getItem('authToken');
            const status = document.getElementById('status');
            const loginSection = document.getElementById('loginSection');
            
            if (token) {
                status.textContent = '‚úÖ Authenticated! You can create posts.';
                status.style.background = 'rgba(0, 255, 0, 0.1)';
                status.style.borderColor = '#4AE54A';
                loginSection.style.display = 'none';
            } else {
                status.textContent = '‚ùå Not authenticated. Click the login button below.';
                status.style.background = 'rgba(255, 0, 0, 0.1)';
                status.style.borderColor = '#FF6B6B';
                loginSection.style.display = 'block';
            }
        }

        async function quickLogin() {
            try {
                const response = await fetch('http://localhost:3001/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        email: 'first@user.com',
                        password: 'test123'
                    })
                });

                const data = await response.json();
                
                if (data.success && data.data?.token) {
                    localStorage.setItem('authToken', data.data.token);
                    showResult('‚úÖ Logged in successfully!');
                    checkAuth();
                } else {
                    showResult('‚ùå Login failed: ' + (data.error || 'Unknown error'), true);
                }
            } catch (error) {
                showResult('‚ùå Login error: ' + error.message, true);
            }
        }

        // Show/hide checkin fields based on type
        document.getElementById('postType').addEventListener('change', function(e) {
            const checkinFields = document.getElementById('checkinFields');
            if (e.target.value === 'checkin') {
                checkinFields.style.display = 'block';
            } else {
                checkinFields.style.display = 'none';
            }
        });

        async function createPost() {
            const token = localStorage.getItem('authToken');
            if (!token) {
                showResult('Please login in the app first!', true);
                return;
            }

            const postType = document.getElementById('postType').value;
            const content = document.getElementById('content').value;
            const visibility = document.getElementById('visibility').value;

            const post = {
                type: postType,
                visibility: visibility,
                content: content
            };

            // Add checkin-specific fields
            if (postType === 'checkin') {
                post.actionTitle = document.getElementById('actionTitle').value;
                post.goalTitle = document.getElementById('goalTitle').value;
                post.goalColor = document.getElementById('goalColor').value;
                post.streak = parseInt(document.getElementById('streak').value);
            }

            console.log('Sending post:', post);

            try {
                const response = await fetch('http://localhost:3001/api/posts', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(post)
                });

                const data = await response.json();
                console.log('Response:', data);
                
                if (data.success) {
                    showResult('‚úÖ Post created successfully!\n\n' + JSON.stringify(data.data, null, 2));
                } else {
                    showResult('‚ùå Error: ' + data.error, true);
                }
            } catch (error) {
                showResult('‚ùå Error: ' + error.message, true);
            }
        }

        function testCheckin() {
            document.getElementById('postType').value = 'checkin';
            document.getElementById('content').value = 'Just crushed my workout! Feeling amazing üí™';
            document.getElementById('visibility').value = 'circle';
            document.getElementById('actionTitle').value = 'Morning HIIT Session';
            document.getElementById('goalTitle').value = 'Lose 10 pounds';
            document.getElementById('goalColor').value = '#10B981';
            document.getElementById('streak').value = '7';
            document.getElementById('checkinFields').style.display = 'block';
        }

        function testStatus() {
            document.getElementById('postType').value = 'status';
            document.getElementById('content').value = 'Consistency is key! Every small step counts towards the bigger goal üöÄ';
            document.getElementById('visibility').value = 'follow';
            document.getElementById('checkinFields').style.display = 'none';
        }

        function testGoal() {
            document.getElementById('postType').value = 'goal';
            document.getElementById('content').value = 'New goal alert! üéØ Starting my journey to run a marathon by end of year!';
            document.getElementById('visibility').value = 'public';
            document.getElementById('checkinFields').style.display = 'none';
        }

        async function fetchPosts() {
            const token = localStorage.getItem('authToken');
            if (!token) {
                showResult('Please login in the app first!', true);
                return;
            }

            try {
                const response = await fetch('http://localhost:3001/api/feed/circle', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const data = await response.json();
                if (data.success) {
                    const posts = data.data || [];
                    const summary = posts.map(p => 
                        `[${p.type}] ${p.user?.name}: "${p.content}" ${p.actionTitle ? '(‚úÖ ' + p.actionTitle + ')' : ''}`
                    ).join('\n\n');
                    showResult(`üìñ Found ${posts.length} posts:\n\n${summary || 'No posts yet'}`);
                } else {
                    showResult('‚ùå Error: ' + data.error, true);
                }
            } catch (error) {
                showResult('‚ùå Error: ' + error.message, true);
            }
        }

        function clearForm() {
            document.getElementById('content').value = '';
            document.getElementById('postType').value = 'status';
            document.getElementById('visibility').value = 'circle';
            document.getElementById('checkinFields').style.display = 'none';
            showResult('Form cleared', false);
        }

        function showResult(message, isError = false) {
            const result = document.getElementById('result');
            result.textContent = message;
            result.className = isError ? 'result error' : 'result';
            result.style.display = 'block';
        }
    </script>
</body>
</html>